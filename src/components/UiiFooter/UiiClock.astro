---
import "@styles/UiiClock.css";

// Get build date
const buildDate = new Date();
const locale = Intl.getCanonicalLocales("en-UK")[0];
---

<div id="uii-clock">
    <p id="uii-clock-date">Last update:</p>
    <p id="uii-clock-time">
        {
            buildDate.toLocaleDateString(locale, {
                day: "2-digit",
                month: "2-digit",
            })
        }
    </p>
</div>

<script>
    // Note: This is a Astro-managed script, it will execute once for all instances of this component.
    const clockDate = document.getElementById("uii-clock-date");
    const clockTime = document.getElementById("uii-clock-time");
    const locale = Intl.getCanonicalLocales("en-UK")[0];
    if (!clockDate || !clockTime) {
        throw new Error("Clock elements not found");
    }

    function updateClock(): Date {
        const curDate = new Date();
        clockDate.textContent = curDate.toLocaleDateString(locale, {
            weekday: "short",
            day: "2-digit",
            month: "short",
        });
        clockTime.textContent = curDate.toLocaleTimeString(locale, {
            hour: "2-digit",
            minute: "2-digit",
            hour12: false,
        });
        return curDate;
    }

    const now = updateClock();
    const msUntilNextMinute =
        (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
    setTimeout(() => {
        updateClock();
        setInterval(updateClock, 60000); // Update every minute
    }, msUntilNextMinute);
</script>
